<Project>
	<PropertyGroup>
		<TargetFramework>net9.0</TargetFramework>

		<!-- Some features we use require a documentation file, like analyzers, and the docs manifest generation -->
		<GenerateDocumentationFile>true</GenerateDocumentationFile>

		<!-- Debug symbols -->
		<DebugType>embedded</DebugType>
		<DebugSymbols>true</DebugSymbols>

		<EmbedUntrackedSources>true</EmbedUntrackedSources>
		<PublishRepositoryUrl>true</PublishRepositoryUrl>

		<!--
			Set compiler in "strict" mode, which enables some checks that weren't enabled by default, due to them being
			breaking changes (i.e. compiling some code fine one version, and then no longer compiling the next).
		-->
		<Features>strict</Features>

		<!--
			Faster NuGet restores
			https://learn.microsoft.com/en-us/nuget/release-notes/nuget-5.5#summary-whats-new-in-55
		-->
		<RestoreUseStaticGraphEvaluation>true</RestoreUseStaticGraphEvaluation>

		<!-- Treat warnings as errors in "Release" builds -->
		<!--
		<TreatWarningsAsErrors Condition=" '$(Configuration)' == 'Release' ">true</TreatWarningsAsErrors>
		<MSBuildTreatWarningsAsErrors Condition="' $(Configuration)' == 'Release' ">true</MSBuildTreatWarningsAsErrors>
		-->

		<!--
			CS1591: Missing XML comment for publicly visible type or member

			CS8669: The annotation for nullable reference types should only be used in code within a '#nullable' annotations context. Auto-generated code requires an explicit '#nullable' directive in source.
			https://github.com/dotnet/razor/issues/8720

			NU5128: No lib or ref assemblies, because we're shipping an analyzer.
		-->
		<NoWarn>CS1591;CS8669;NU5128</NoWarn>

		<!-- Put any generated stuff (including "bin" and  "obj" folders, and NuGet packages) in an "artifacts" folder, instead of spread out across the source. -->
		<ArtifactsPath>$(MSBuildThisFileDirectory)/../artifacts</ArtifactsPath>
	</PropertyGroup>

	<!-- Regular Projects -->
	<PropertyGroup Condition="!$(MSBuildProjectName.EndsWith('Test'))">
		<Nullable>enable</Nullable>

		<!-- Code analysis -->
		<AnalysisLevel>9.0-all</AnalysisLevel>
		<AnalysisMode>all</AnalysisMode>
		<EnableNETAnalyzers>true</EnableNETAnalyzers>
		<EnforceCodeStyleInBuild>true</EnforceCodeStyleInBuild>
		<RunAnalyzers>true</RunAnalyzers>
		<RunAnalyzersDuringBuild>true</RunAnalyzersDuringBuild>
		<RunAnalyzersDuringLiveAnalysis>true</RunAnalyzersDuringLiveAnalysis>

		<!-- Explicitly overridden per project -->
		<IsPackable>false</IsPackable>
	</PropertyGroup>

	<!-- Versioning -->
	<ItemGroup>
		<PackageReference Include="Nerdbank.GitVersioning" PrivateAssets="All"/>
	</ItemGroup>

	<!-- Analyzers -->
	<ItemGroup>
		<PackageReference Include="Microsoft.VisualStudio.Threading.Analyzers" PrivateAssets="all" IncludeAssets="runtime; build; native; contentfiles; analyzers; buildtransitive"/>
		<PackageReference Include="SonarAnalyzer.CSharp" PrivateAssets="all" IncludeAssets="runtime; build; native; contentfiles; analyzers; buildtransitive"/>
		<PackageReference Include="StyleCop.Analyzers.Unstable" PrivateAssets="all" IncludeAssets="runtime; build; native; contentfiles; analyzers; buildtransitive"/>
	</ItemGroup>

	<!-- Test projects -->
	<ItemGroup Condition=" $(MSBuildProjectName.EndsWith('Test')) ">
		<PackageReference Include="Microsoft.NET.Test.Sdk"/>
		<PackageReference Include="Moq"/>
		<PackageReference Include="MSTest.TestAdapter"/>
		<PackageReference Include="MSTest.TestFramework"/>
		<PackageReference Include="Verify.MSTest"/>
	</ItemGroup>
</Project>